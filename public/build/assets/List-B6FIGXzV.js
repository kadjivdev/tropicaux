import{a as S,r as h,u as L,j as e,H as A,L as c}from"./app-DgXsXDYL.js";import{A as V,a as _,c as O}from"./AuthenticatedLayout-DWq0jx2p.js";import{C as n}from"./index.esm-BVe4MvQ8.js";import{S as t}from"./sweetalert2.esm.all-Bj_ZQUAw.js";import{M as D,S as E}from"./SecondaryButton-DXDXR_Hg.js";import{I as M}from"./InputLabel-DSSF3Pef.js";import{T as I}from"./TextInput-3yUbSH3K.js";import{I as P}from"./InputError-B2O5XA0Y.js";import{P as z}from"./PrimaryButton-0HbCHAkt.js";import{S as R}from"./react-select.esm-B4CN5FXn.js";import{c as q}from"./cib-addthis-BMGhLLu9.js";import{c as G}from"./cil-menu-Za6MY1fF.js";import{c as H}from"./cil-pencil-m516yCOw.js";import{c as X}from"./cil-check-circle-BlU9eaow.js";import{c as f}from"./cil-send-haInf9fd.js";import{c as U}from"./cil-cloud-download-CPU_poQw.js";import{c as J}from"./cil-truck-DQWpTLfo.js";import"./transition-Dn9yB-P7.js";import"./ApplicationLogo-CaVldKYI.js";import"./logo-spwKF6je.js";import"./description-Dx0CJf8V.js";function fe({financements:j,gestionnaires:m}){const g=S().props.auth.permissions,l=s=>g.some(r=>r.name==s),[o,b]=h.useState(null),[v,i]=h.useState(!1),{data:y,setData:u,errors:N,processing:x,patch:w,post:C,delete:k}=L({reste:o?.reste,gestionnaire_id:null}),B=(s,r)=>{s.preventDefault(),t.fire({title:'<span style="color: #facc15;">âš ï¸ ÃŠtes-vous sÃ»r ?</span>',text:"Le prÃ©-financement sera supprimÃ© de faÃ§on permanente !",showCancelButton:!0,confirmButtonColor:"#2a7348",cancelButtonColor:"#3085d6",confirmButtonText:"ğŸ˜‡ Oui, supprimer !",cancelButtonText:"Annuler"}).then(a=>{a.isConfirmed&&(t.fire({title:'<span style="color: #facc15;">ğŸ«  Suppression en cours...</span>',text:"Veuillez patienter pendant que nous traitons vos donnÃ©es.",allowOutsideClick:!1,didOpen:()=>{t.showLoading()}}),k(route("prefinancement.destroy",r.id),{onSuccess:()=>{t.close(),t.fire({title:'<span style="color: #2a7348;">ğŸ‘ŒSuppression rÃ©ussie </span>',text:"Le prÃ©-financement a Ã©tÃ© supprimÃ© avec succÃ¨s.",confirmButtonText:"ğŸ˜‡ Fermer"})},onError:d=>{t.close(),t.fire({title:'<span style="color: #facc15;">ğŸ¤¦â€â™‚ï¸ Suppression Ã©chouÃ©e </span>',text:`${d.exception??"Veuillez rÃ©essayer."}`,confirmButtonText:"ğŸ˜‡ Fermer"})}}))})},F=(s,r)=>{s.preventDefault(),t.fire({title:'<span style="color: #facc15;">âš ï¸ ÃŠtes-vous sÃ»r ?</span>',text:"Ce prÃ©-financement sera validÃ© de faÃ§on permanente !",showCancelButton:!0,confirmButtonColor:"#2a7348",cancelButtonColor:"#3085d6",confirmButtonText:"ğŸ˜‡ Oui, valider !",cancelButtonText:"Annuler"}).then(a=>{a.isConfirmed&&(t.fire({title:'<span style="color: #facc15;">ğŸ«  Validation en cours...</span>',text:"Veuillez patienter pendant que nous traitons vos donnÃ©es.",allowOutsideClick:!1,didOpen:()=>{t.showLoading()}}),w(route("prefinancement.validate",r.id),{onSuccess:()=>{t.close(),t.fire({title:'<span style="color: #2a7348;">Validation rÃ©ussie </span>',text:"Le prÃ©-financement a Ã©tÃ© validÃ© avec succÃ¨s.",confirmButtonText:"ğŸ˜‡ Fermer"})},onError:d=>{t.close(),t.fire({title:'<span style="color: #facc15;">ğŸ¤¦â€â™‚ï¸ Validation Ã©chouÃ©e </span>',text:`${d.exception??"Veuillez rÃ©essayer."}`,confirmButtonText:"ğŸ˜‡ Fermer"})}}))})},p=()=>{i(!1)},T=(s,r)=>{s.preventDefault(),b(r),u("reste",r.reste),i(!0)},$=s=>{s.preventDefault(),t.fire({title:'<span style="color: #facc15;">âš ï¸ ÃŠtes-vous sÃ»r ?</span>',text:`Le reste (${o?.reste} FCFA) du prÃ©-financement (${o?.reference}) sera transfÃ©rÃ© de faÃ§on permanente !`,showCancelButton:!0,confirmButtonColor:"#2a7348",cancelButtonColor:"#3085d6",confirmButtonText:"ğŸ˜‡ Oui, valider !",cancelButtonText:"Annuler"}).then(r=>{r.isConfirmed&&(t.fire({title:'<span style="color: #facc15;">ğŸ«  Validation en cours...</span>',text:"Veuillez patienter pendant que nous traitons vos donnÃ©es.",allowOutsideClick:!1,didOpen:()=>{t.showLoading()}}),C(route("prefinancement.transfert-reste",o?.id),{onSuccess:()=>{t.close(),t.fire({title:'<span style="color: #2a7348;">Transfert rÃ©ussi </span>',text:`Le reste (${o?.reste} FCFA) du prÃ©-financement (${o?.reference}) a Ã©tÃ© transferÃ© avec succÃ¨s.`,confirmButtonText:"ğŸ˜‡ Fermer"}),i(!1)},onError:a=>{t.close(),t.fire({title:'<span style="color: #facc15;">ğŸ¤¦â€â™‚ï¸ Transfert Ã©chouÃ© </span>',text:`${a.exception??"Veuillez rÃ©essayer."}`,confirmButtonText:"ğŸ˜‡ Fermer"})}}))})};return e.jsxs(V,{header:e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200",children:[e.jsx(n,{className:"text-success",icon:O})," Gestion des prÃ©-financements"]}),children:[e.jsx(A,{title:"Les PrÃ©-Financements"}),e.jsx("div",{className:"row py-12 justify-content-center",children:e.jsx("div",{className:"col-md-10 bg-white p-4 shadow sm:rounded-lg sm:p-8 dark:bg-gray-800",children:e.jsxs("div",{className:"mx-auto _max-w-7xl space-y-6 sm:px-6 lg:px-8 ",style:{overflowX:"auto"},children:[l("prefinancement.create")?e.jsx("div",{className:"text-center  items-center gap-4",children:e.jsxs(c,{className:"btn w-50 bg-success bg-hover text-white",href:route("prefinancement.create"),children:[" ",e.jsx(n,{className:"",icon:q})," Ajouter"]})}):null,e.jsxs("table",{className:"table table-striped",id:"myTable",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{scope:"col",children:"NÂ°"}),e.jsx("th",{scope:"col text-center",children:"Action"}),e.jsx("th",{scope:"col",children:"Reference"}),e.jsx("th",{scope:"col",children:"Gestionnaire"}),e.jsx("th",{scope:"col",children:"Montant"}),e.jsx("th",{scope:"col",children:"Montant DispatchÃ©"}),e.jsx("th",{scope:"col",children:"Reste"}),e.jsx("th",{scope:"col",children:"Date de financement"}),e.jsx("th",{scope:"col",children:"Preuve"}),e.jsx("th",{scope:"col",children:"InsÃ©rÃ© par"}),e.jsx("th",{scope:"col",children:"ValidÃ© le"}),e.jsx("th",{scope:"col",children:"ValidÃ© par"})]})}),e.jsx("tbody",{children:j.data.map((s,r)=>e.jsxs("tr",{children:[e.jsx("th",{scope:"row",children:r+1}),e.jsx("td",{children:s.validated_at?"---":e.jsxs("div",{className:"dropstart",children:[e.jsxs("button",{className:"dropdown-toggle inline-flex items-center rounded-md border border-transparent bg-white px-3 py-2 text-sm font-medium leading-4 text-gray-500 transition duration-150 ease-in-out hover:text-gray-700 focus:outline-none dark:bg-gray-800 dark:text-gray-400 dark:hover:text-gray-300",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",children:[e.jsx(n,{icon:G})," GÃ©rer"]}),e.jsxs("ul",{className:"dropdown-menu p-2 border rounded shadow",children:[e.jsx("li",{children:l("prefinancement.edit")?e.jsxs(c,{className:"btn text-warning",href:route("prefinancement.edit",s.id),children:[e.jsx(n,{icon:H}),"  Modifier"]}):null}),e.jsx("li",{children:l("prefinancement.validate")?e.jsxs(c,{href:"#",className:"btn text-success",onClick:a=>F(a,s),children:[e.jsx(n,{icon:X}),"  Valider"]}):null}),e.jsx("li",{children:l("prefinancement.delete")?e.jsxs(c,{href:"#",className:"btn text-danger",onClick:a=>B(a,s),children:[e.jsx(n,{icon:_}),"  Supprimer"]}):null})]})]})}),e.jsxs("td",{children:[e.jsxs("span",{className:"badge bg-light rounded text-dark rounded shadow-sm",children:[" ",s?.reference??"---"]})," "]}),e.jsx("td",{children:`${s?.gestionnaire?.lastname} - ${s?.gestionnaire?.firstname}`}),e.jsx("td",{children:e.jsxs("span",{className:"badge bg-light rounded text-dark rounded shadow-sm",children:[s.montant," FCFA"]})}),e.jsx("td",{children:e.jsxs("strong",{className:"badge bg-light rounded text-dark rounded shadow-sm",children:[s.montant_dispatche," FCFA"]})}),e.jsxs("td",{className:"text-center",children:[e.jsxs("span",{className:"badge bg-light rounded text-success rounded shadow-sm",children:[s.reste," FCFA"]}),s.reste>0&&e.jsxs("button",{className:"btn btn-sm btn-light border rounded w-100 shadow text-center",onClick:a=>T(a,s),children:[" ",e.jsx(n,{icon:f,className:"text-success"})," Transferer "]})]}),e.jsx("td",{children:s.date_financement}),e.jsx("td",{children:s.document?e.jsx("a",{className:"btn btn-sm shadow border rounded text-dark",target:"_blank",href:s.document,children:e.jsx(n,{className:"text-success",icon:U})}):e.jsx("span",{className:"text-muted",children:"---"})}),e.jsxs("td",{children:[" ",e.jsx("span",{className:"badge bg-light border rounded text-dark",children:`${s.createdBy?.firstname} - ${s.createdBy?.lastname}`})," "]}),e.jsxs("td",{children:[" ",e.jsx("span",{className:"badge bg-light border rounded text-dark",children:`${s.validated_at||"--"}`})," "]}),e.jsxs("td",{children:[" ",e.jsx("span",{className:"badge bg-light border rounded text-dark",children:`${s.validatedBy?.firstname||""} - ${s.validatedBy?.lastname||""}`})," "]})]},s.id))})]})]})})}),e.jsx(D,{show:v,onClose:p,children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 dark:text-gray-100",children:[e.jsx(n,{className:"text-success",icon:J})," Transfert du reste du prÃ©-financement ",e.jsx("span",{className:"badge bg-light rounded border shadow-sm text-success",children:o?.reference??"---"})]}),e.jsxs("form",{onSubmit:$,className:"mt-6 space-y-6",children:[e.jsxs("div",{className:"row d-flex justify-content-center",children:[e.jsx("div",{className:"col-md-6",children:e.jsx("div",{className:"mb-3",children:e.jsx(R,{placeholder:"Rechercher un gestionnaire ...",name:"gestionnaire_id",id:"gestionnaire_id",required:!0,className:"form-control mt-1 block w-full",options:m.map(s=>({value:s.id,label:`${s.firstname} - ${s.lastname}`})),value:m.map(s=>({value:s.id,label:`${s.firstname} - ${s.lastname}`})).find(s=>s.value===y.gestionnaire_id),onChange:s=>u("gestionnaire_id",s.value)})})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(M,{htmlFor:"reste",value:"Reste du prÃ©-financement",children:[" ",e.jsx("span",{className:"text-danger",children:"*"})," "]}),e.jsx(I,{id:"reste",type:"number",className:"mt-1 block w-full",value:o?.reste,autoComplete:"reste",readOnly:!0,required:!0}),e.jsx(P,{className:"mt-2",message:N.reste})]})})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(z,{disabled:x,children:[" ",e.jsx(n,{icon:f})," ",x?"Enregistrement ...":"Enregistrer"," "]})})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(E,{className:"text-success",onClick:p,children:"Fermer"})})]})})]})}export{fe as default};
